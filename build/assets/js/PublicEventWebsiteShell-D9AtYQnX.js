import{j as e,R as t}from"./puck-vendor-BeE6vXWX.js";import{r}from"./react-vendor-BdxBrZfF.js";import{h as s,A as n,a as o,b as a}from"./index-DDsewsre.js";import{g as i}from"./EditorView-BQh-7R5p.js";import"./icons-vendor-DZgrt25s.js";import"./survey-vendor-CTcUtol2.js";import"./ScheduleContent-D382J5wU.js";import"./Button-uoBYYsUr.js";import"./UploadModal-C41ctmbp.js";import"./resourceService-BJ2cjR8T.js";const l=({eventName:t,logoUrl:r,items:s,activePath:n,onNavigate:o})=>e.jsx("header",{className:"fixed top-0 left-0 z-[1000] w-full border-b border-slate-200 bg-white/90 backdrop-blur",children:e.jsxs("div",{className:"mx-auto flex h-16 max-w-7xl items-center justify-between gap-4 px-4 sm:px-6",children:[e.jsxs("button",{type:"button",onClick:()=>{var e;return o((null==(e=s[0])?void 0:e.path)??"/")},className:"flex min-w-0 items-center gap-3 text-left","aria-label":"Go to home",children:[r?e.jsx("img",{src:r,alt:"Event logo",className:"h-9 w-9 rounded-md object-cover ring-1 ring-slate-200"}):e.jsx("div",{className:"h-9 w-9 rounded-md bg-slate-100 ring-1 ring-slate-200"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-slate-900",children:t||"Event"}),e.jsx("div",{className:"truncate text-xs text-slate-500",children:"Event website"})]})]}),e.jsx("nav",{className:"hidden items-center gap-1 md:flex","aria-label":"Primary",children:s.map(t=>{const r=n===t.path;return e.jsx("button",{type:"button",onClick:()=>o(t.path),className:["rounded-lg px-3 py-2 text-sm font-medium transition-colors",r?"bg-slate-900 text-white":"text-slate-700 hover:bg-slate-100"].join(" "),children:t.label},t.path)})}),e.jsx("nav",{className:"flex flex-1 items-center justify-end gap-2 overflow-x-auto md:hidden",children:s.map(t=>{const r=n===t.path;return e.jsx("button",{type:"button",onClick:()=>o(t.path),className:["whitespace-nowrap rounded-full px-3 py-1.5 text-xs font-semibold transition-colors",r?"bg-slate-900 text-white":"bg-slate-100 text-slate-700"].join(" "),children:t.label},t.path)})})]})}),c=async e=>{try{if(!e){const e=s("Event UUID is required.",void 0,"Event UUID is required.");throw new Error(e)}const r=n.PUBLIC.EVENT.GET(e),i=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i||!i.ok){if(!i){const e=o(null);throw new Error(e)}try{const e=await i.text();let t=null;try{t=e?JSON.parse(e):null}catch{if(e&&e.trim()){const t=s(e.trim(),i,"An error occurred. Please try again.");throw new Error(t)}}if(t){const e=s(t,i,"An error occurred. Please try again.");throw new Error(e)}const r=s(null,i,"An error occurred. Please try again.");throw new Error(r)}catch(t){if(t instanceof Error)throw t;const e=s(null,i,"An error occurred. Please try again.");throw new Error(e)}}let l;try{l=await i.json()}catch{const e=a("Invalid response from server. Please try again.");throw new Error(e)}if("error"===(null==l?void 0:l.status)){const e=s(l,void 0,"Failed to fetch event. Please try again.");throw new Error(e)}const c=(null==l?void 0:l.data)??l;if(!c||"object"!=typeof c){const e=a("Invalid response from server. Please try again.");throw new Error(e)}return c}catch(r){if(r instanceof TypeError&&r.message.includes("fetch"))throw r.message.includes("Cannot connect")||o(),new Error(r.message||"Network error occurred");throw r instanceof Error?r:new Error("Failed to fetch event. Please try again.")}},d=async e=>{try{if(!e){const e=s("Event UUID is required.",void 0,"Event UUID is required.");throw new Error(e)}const r=n.PUBLIC.WEBPAGES.LIST(e),i=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i||!i.ok){if(!i){const e=o(null);throw new Error(e)}try{const e=await i.text();let t=null;try{t=e?JSON.parse(e):null}catch{if(e&&e.trim()){const t=s(e.trim(),i,"An error occurred. Please try again.");throw new Error(t)}}if(t){const e=s(t,i,"An error occurred. Please try again.");throw new Error(e)}const r=s(null,i,"An error occurred. Please try again.");throw new Error(r)}catch(t){if(t instanceof Error)throw t;const e=s(null,i,"An error occurred. Please try again.");throw new Error(e)}}let l;try{l=await i.json()}catch{const e=a("Invalid response from server. Please try again.");throw new Error(e)}if("error"===(null==l?void 0:l.status)){const e=s(l,void 0,"Failed to fetch webpages. Please try again.");throw new Error(e)}const c=(null==l?void 0:l.data)??(null==l?void 0:l.results)??l;return Array.isArray(c)?c:c&&"object"==typeof c&&Array.isArray(c.results)?c.results:[]}catch(r){if(r instanceof TypeError&&r.message.includes("fetch"))throw r.message.includes("Cannot connect")||o(),new Error(r.message||"Network error occurred");throw r instanceof Error?r:new Error("Failed to fetch webpages. Please try again.")}},u=({eventUuid:l,webpageUuid:c})=>{var d,u;const[h,m]=r.useState(null),[w,p]=r.useState(!0),[v,f]=r.useState(null);r.useEffect(()=>{let e=!1;return(async()=>{p(!0),f(null);try{const t=await(async(e,t)=>{try{if(!e){const e=s("Event UUID is required.",void 0,"Event UUID is required.");throw new Error(e)}if(!t){const e=s("Webpage UUID is required.",void 0,"Webpage UUID is required.");throw new Error(e)}const i=n.PUBLIC.WEBPAGES.GET(e,t),l=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(!l||!l.ok){if(!l){const e=o(null);throw new Error(e)}try{const e=await l.text();let t=null;try{t=e?JSON.parse(e):null}catch{if(e&&e.trim()){const t=s(e.trim(),l,"An error occurred. Please try again.");throw new Error(t)}}if(t){const e=s(t,l,"An error occurred. Please try again.");throw new Error(e)}const r=s(null,l,"An error occurred. Please try again.");throw new Error(r)}catch(r){if(r instanceof Error)throw r;const e=s(null,l,"An error occurred. Please try again.");throw new Error(e)}}let c;try{c=await l.json()}catch{const e=a("Invalid response from server. Please try again.");throw new Error(e)}if("error"===(null==c?void 0:c.status)){const e=s(c,void 0,"Failed to fetch webpage. Please try again.");throw new Error(e)}const d=(null==c?void 0:c.data)??c;if(!d||"object"!=typeof d){const e=a("Invalid response from server. Please try again.");throw new Error(e)}return d}catch(v){if(v instanceof TypeError&&v.message.includes("fetch"))throw v.message.includes("Cannot connect")||o(),new Error(v.message||"Network error occurred");throw v instanceof Error?v:new Error("Failed to fetch webpage. Please try again.")}})(l,c);e||m(t)}catch(t){const r=t instanceof Error?t.message:"Failed to load page.";e||f(r)}finally{e||p(!1)}})(),()=>{e=!0}},[l,c]);const g=r.useMemo(()=>h?(e=>{const t=null==e?void 0:e.content;if(!t||"object"!=typeof t)return null;const r=Object.keys(t);if(0===r.length)return null;const s=t[r[0]];if(!s||!s.data)return null;const n=Object.keys(s.data);if(0===n.length)return null;const o="string"==typeof e.slug?e.slug.toLowerCase():void 0,a="string"==typeof s.slug?s.slug.toLowerCase():void 0;let i=n[0];o&&n.includes(o)?i=o:a&&n.includes(a)&&(i=a);const l=s.data[i];return l?{content:l.content||[],root:l.root||{},zones:l.zones||{}}:null})(h):null,[h]),x=null==(u=null==(d=null==g?void 0:g.root)?void 0:d.props)?void 0:u.pageType,b=null==h?void 0:h.name,y=r.useMemo(()=>i(x,b),[x,b]);return w?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"text-sm font-medium text-slate-600",children:"Loading page…"})}):v?e.jsxs("div",{className:"rounded-xl border border-rose-200 bg-rose-50 p-6",children:[e.jsx("div",{className:"text-lg font-semibold text-rose-900",children:"Failed to load page"}),e.jsx("div",{className:"mt-1 text-sm text-rose-800",children:v})]}):h&&g?e.jsx("div",{className:"min-h-[50vh]",children:e.jsx(t,{config:y,data:g})}):e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"Page not available"}),e.jsx("div",{className:"mt-1 text-sm text-slate-600",children:"This page is missing or the response format is unsupported."})]})},h=({eventUuid:t})=>{var s;const[n,o]=r.useState(null),[a,i]=r.useState([]),[h,m]=r.useState(!0),[w,p]=r.useState(null),[v,f]=r.useState(window.location.pathname);r.useEffect(()=>{(async()=>{m(!0),p(null);try{const[e,r]=await Promise.all([c(t),d(t)]);o(e),i(Array.isArray(r)?r:[])}catch(e){const t=e instanceof Error?e.message:"Failed to load website.";p(t)}finally{m(!1)}})();const e=()=>f(window.location.pathname);return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[t]);const g=r.useMemo(()=>[...[{label:"Speakers",path:`/events/${t}/speakers`},{label:"Attendees",path:`/events/${t}/attendees`},{label:"Schedule",path:`/events/${t}/schedule`},{label:"Sessions",path:`/events/${t}/sessions`}],...a.map(e=>({label:e.name,path:`/events/${t}/webpages/${e.uuid}`}))],[t,a]),x=r.useMemo(()=>((e,t)=>{const r=`/events/${e}`,s=t.startsWith(r)?t.slice(r.length):t,n=s.match(/^\/webpages\/([^/]+)\/?$/);return n?{section:"webpage",webpageUuid:n[1]}:s.startsWith("/speakers")?{section:"speakers"}:s.startsWith("/attendees")?{section:"attendees"}:s.startsWith("/schedule")?{section:"schedule"}:s.startsWith("/sessions")?{section:"sessions"}:{section:"webpage"}})(t,v),[t,v]),b=null==(s=a[0])?void 0:s.uuid,y=x.webpageUuid??b;return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx(l,{eventName:null==n?void 0:n.eventName,logoUrl:(null==n?void 0:n.logo)??null,items:g,activePath:v,onNavigate:e=>{window.history.pushState({},"",e),window.dispatchEvent(new PopStateEvent("popstate"))}}),e.jsx("main",{className:"mx-auto max-w-7xl px-4 pb-12 pt-20 sm:px-6",children:h?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"text-sm font-medium text-slate-600",children:"Loading website…"})}):w?e.jsxs("div",{className:"rounded-xl border border-rose-200 bg-rose-50 p-6",children:[e.jsx("div",{className:"text-lg font-semibold text-rose-900",children:"Unable to load this event"}),e.jsx("div",{className:"mt-1 text-sm text-rose-800",children:w})]}):"webpage"===x.section?y?e.jsx(u,{eventUuid:t,webpageUuid:y}):e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"No pages yet"}),e.jsx("div",{className:"mt-1 text-sm text-slate-600",children:"This event doesn’t have any published webpages."})]}):e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-900",children:"Coming soon"}),e.jsx("div",{className:"mt-1 text-sm text-slate-600",children:"This section will be connected once the public endpoints are provided."})]})})]})};export{h as default};
