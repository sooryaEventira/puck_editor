import{j as e}from"./puck-vendor-DXoNcV6M.js";import{r as t,R as s}from"./react-vendor-BdxBrZfF.js";import{M as r,h as a,A as i,b as n,a as o,s as l,u as c,I as d,E as u}from"./index-CzmsYrX1.js";import{d as m,E as f}from"./EventHubContent-B0JxVqMT.js";import{v as p,X as h,e as x,I as g,c as v,d as y,a as w,f as b,S as j,F as N,k as E,w as C,x as S}from"./icons-vendor-BSdtBVbM.js";import{B as I}from"./Button-D8bD4I8G.js";import{U}from"./UploadModal-Bxt6QkqM.js";const k=({isOpen:s,onClose:r,options:a,position:i})=>{const n=t.useRef(null);return t.useEffect(()=>{const e=e=>{n.current&&!n.current.contains(e.target)&&r()};if(s)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[s,r]),s?e.jsx("div",{ref:n,className:"fixed z-50 rounded-lg border border-slate-200 bg-white shadow-lg py-1",style:{left:`${i.x}px`,top:`${i.y}px`,width:"max-content"},children:a.map((t,s)=>e.jsx("button",{type:"button",onClick:()=>{t.action(),r()},className:"block w-full px-2.5 py-1.5 text-left text-sm transition-colors whitespace-nowrap "+("destructive"===t.variant?"text-rose-600 hover:bg-rose-50":"text-slate-700 hover:bg-slate-50"),children:t.label},s))}):null},P=({isVisible:s,onClose:a,onMove:i,folders:n,currentFolderId:o,fileName:l})=>{const[c,d]=t.useState(null);return e.jsx(r,{isVisible:s,onClose:a,title:"Move to folder",subtitle:`Move "${l}" to a folder`,width:400,footer:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(I,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(I,{variant:"primary",onClick:()=>{i(c),a()},children:"Move"})]}),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Select folder"}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[e.jsxs("button",{type:"button",onClick:()=>d(null),className:"w-full flex items-center gap-3 px-3 py-2 rounded-md text-left transition-colors "+(null===c?"bg-primary/10 border border-primary":"hover:bg-slate-50 border border-transparent"),children:[e.jsx(p,{className:"h-4 w-4 text-slate-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:"All media (root)"})]}),n.filter(e=>e.id!==o).map(t=>e.jsxs("button",{type:"button",onClick:()=>d(t.id),className:"w-full flex items-center gap-3 px-3 py-2 rounded-md text-left transition-colors "+(c===t.id?"bg-primary/10 border border-primary":"hover:bg-slate-50 border border-transparent"),children:[e.jsx(p,{className:"h-4 w-4 text-slate-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:t.name})]},t.id))]})]})})})},D=async(e,t)=>{try{const s=localStorage.getItem("accessToken");if(!s){const e=a("Authentication required. Please log in again.",void 0,"Authentication required. Please log in again.");throw new Error(e)}const r=localStorage.getItem("organizationUuid");if(!r){const e=a("Organization UUID is required. Please set up your organization first.",void 0,"Organization UUID is required. Please set up your organization first.");throw new Error(e)}if(!e){const e=a("Event UUID is required to fetch folders.",void 0,"Event UUID is required to fetch folders.");throw new Error(e)}const o=await fetch(i.RESOURCE.LIST_FOLDERS(e,t),{method:"GET",headers:{Authorization:`Bearer ${s}`,"X-Organization":r}});if(!o.ok){const e=await o.text();let t=null;try{t=JSON.parse(e)}catch{}const s=a(t||e,o,"An error occurred. Please try again.");throw new Error(s)}const l=await o.text();let c,d;try{c=JSON.parse(l)}catch{const e=n("Invalid response format from server. Please try again.");throw new Error(e)}if("success"===c.status&&c.data&&Array.isArray(c.data))d=c.data;else if(Array.isArray(c))d=c;else{if(!c.results||!Array.isArray(c.results))return[];d=c.results}return d}catch(s){if(s instanceof TypeError&&s.message.includes("fetch"))throw s.message.includes("Cannot connect")||o(),new Error(s.message||"Network error occurred");if(s instanceof Error&&(s.message.includes("Cannot connect")||s.message.includes("Invalid response")||s.message.includes("Authentication required")||s.message.includes("Organization UUID")||s.message.includes("Event UUID")||s.message.includes("Failed to")))throw s;const e=s instanceof Error?s.message:"Failed to fetch folders. Please try again.";throw a(e,void 0,"Failed to fetch folders. Please try again."),new Error(e)}},O=async e=>{try{const t=localStorage.getItem("accessToken");if(!t){const e=a("Authentication required. Please log in again.",void 0,"Authentication required. Please log in again.");throw new Error(e)}const s=localStorage.getItem("organizationUuid");if(!s){const e=a("Organization UUID is required. Please set up your organization first.",void 0,"Organization UUID is required. Please set up your organization first.");throw new Error(e)}if(!e.event_uuid){const e=a("Event UUID is required to upload file.",void 0,"Event UUID is required to upload file.");throw new Error(e)}const r=new FormData;r.append("file",e.file),r.append("event_uuid",e.event_uuid),null!==e.parent&&void 0!==e.parent&&""!==e.parent&&r.append("folder",e.parent);const o=await fetch(i.RESOURCE.UPLOAD_FILE,{method:"POST",headers:{Authorization:`Bearer ${t}`,"X-Organization":s},body:r});if(!o.ok){const e=await o.text();let t=null;try{t=JSON.parse(e)}catch{}const s=a(t||e,o,"Failed to upload file. Please try again.");throw new Error(s)}const l=await o.text();let c,d;try{c=JSON.parse(l)}catch{const e=n("Invalid response format from server. Please try again.");throw new Error(e)}if("success"===c.status&&c.data)d=c.data;else{if(!c.uuid){const e=n("Invalid response format from server. Please try again.");throw new Error(e)}d=c}return d}catch(t){if(t instanceof TypeError&&t.message.includes("fetch"))throw t.message.includes("Cannot connect")||o(),new Error(t.message||"Network error occurred");if(t instanceof Error&&(t.message.includes("Cannot connect")||t.message.includes("Invalid response")||t.message.includes("Authentication required")||t.message.includes("Organization UUID")||t.message.includes("Event UUID")||t.message.includes("Failed to")))throw t;const e=t instanceof Error?t.message:"Failed to upload file. Please try again.";throw a(e,void 0,"Failed to upload file. Please try again."),new Error(e)}},A=({isVisible:s,onClose:n,onConfirm:d,itemName:u,itemType:m,itemId:f})=>{const[p,x]=t.useState(!1),{createdEvent:g}=c();t.useEffect(()=>{s||x(!1)},[s]);return e.jsx(r,{isVisible:s,onClose:n,title:"",subtitle:"",width:400,padding:{top:24,right:24,bottom:0,left:24},showCloseButton:!1,showHeaderBorder:!1,customHeader:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h2",{className:"text-xl font-semibold text-slate-900",children:["Delete ","folder"===m?"folder":"file"]})}),e.jsx("button",{type:"button",onClick:n,className:"inline-flex h-9 w-9 -mt-1 items-center justify-center rounded-md text-slate-500 transition-colors hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/40",children:e.jsx(h,{className:"h-5 w-5"})})]}),footer:e.jsxs("div",{className:"flex justify-end gap-3 py-4 -mt-2 bg-white",children:[e.jsx(I,{variant:"secondary",onClick:n,disabled:p,children:"Cancel"}),e.jsx(I,{variant:"destructive",onClick:async()=>{if((null==g?void 0:g.uuid)&&f){x(!0);try{"folder"===m?await(async(e,t)=>{try{const s=localStorage.getItem("accessToken");if(!s){const e=a("Authentication required. Please log in again.",void 0,"Authentication required. Please log in again.");throw new Error(e)}const r=localStorage.getItem("organizationUuid");if(!r){const e=a("Organization UUID is required. Please set up your organization first.",void 0,"Organization UUID is required. Please set up your organization first.");throw new Error(e)}if(!t){const e=a("Event UUID is required to delete folder.",void 0,"Event UUID is required to delete folder.");throw new Error(e)}const n=new URL(i.RESOURCE.DELETE_FOLDER(e));n.searchParams.append("event_uuid",t);const o=await fetch(n.toString(),{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"X-Organization":r}});if(!o.ok){const e=await o.text();let t=null;try{t=JSON.parse(e)}catch{}const s=a(t||e,o,"Failed to delete folder. Please try again.");throw new Error(s)}l.success("Folder deleted successfully")}catch(s){if(s instanceof TypeError&&s.message.includes("fetch"))throw s.message.includes("Cannot connect")||o(),new Error(s.message||"Network error occurred");if(s instanceof Error&&(s.message.includes("Cannot connect")||s.message.includes("Authentication required")||s.message.includes("Organization UUID")||s.message.includes("Event UUID")||s.message.includes("Failed to")))throw s;const e=s instanceof Error?s.message:"Failed to delete folder. Please try again.";throw a(e,void 0,"Failed to delete folder. Please try again."),new Error(e)}})(f,g.uuid):"file"===m&&await(async(e,t)=>{try{const s=localStorage.getItem("accessToken");if(!s){const e=a("Authentication required. Please log in again.",void 0,"Authentication required. Please log in again.");throw new Error(e)}const r=localStorage.getItem("organizationUuid");if(!r){const e=a("Organization UUID is required. Please set up your organization first.",void 0,"Organization UUID is required. Please set up your organization first.");throw new Error(e)}if(!t){const e=a("Event UUID is required to delete file.",void 0,"Event UUID is required to delete file.");throw new Error(e)}const n=new URL(i.RESOURCE.DELETE_FILE(e));n.searchParams.append("event_uuid",t);const o=await fetch(n.toString(),{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"X-Organization":r}});if(!o.ok){const e=await o.text();let t=null;try{t=JSON.parse(e)}catch{}const s=a(t||e,o,"An error occurred. Please try again.");throw new Error(s)}l.success("File deleted successfully")}catch(s){if(s instanceof TypeError&&s.message.includes("fetch"))throw s.message.includes("Cannot connect")||o(),new Error(s.message||"Network error occurred");if(s instanceof Error&&(s.message.startsWith("Cannot connect")||s.message.startsWith("Server error")||s.message.startsWith("Authentication required")||s.message.startsWith("Organization UUID")||s.message.startsWith("Event UUID")))throw s;const e=s instanceof Error?s.message:"Failed to delete file. Please try again.";throw a(e,void 0,"Failed to delete file. Please try again."),new Error(e)}})(f,g.uuid),d(),n()}catch(e){}finally{x(!1)}}},disabled:p,children:p?"Deleting...":"Delete"})]}),children:e.jsx("div",{className:"pt-0 pb-2",children:e.jsxs("p",{className:"text-md text-slate-600 leading-relaxed",children:['Are you sure you want to delete "',u,'"? This action cannot be undone.']})})})},z=({isVisible:s,onClose:a,onSave:i,fileName:n})=>{const[o,l]=t.useState(""),[c,u]=t.useState(""),m=()=>{l(""),u(""),a()};return e.jsx(r,{isVisible:s,onClose:m,title:"",subtitle:"",width:400,padding:{top:24,right:24,bottom:0,left:24},showCloseButton:!1,showHeaderBorder:!1,customHeader:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Gallery/Shortcut"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Create gallery or shortcut to display in your website"})]}),e.jsx("button",{type:"button",onClick:m,className:"inline-flex h-9 w-9 -mt-1 items-center justify-center rounded-md text-slate-500 transition-colors hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/40",children:e.jsx(h,{className:"h-5 w-5"})})]}),footer:e.jsxs("div",{className:"flex justify-end gap-3 py-4 -mt-2 bg-white",children:[e.jsx(I,{variant:"secondary",onClick:m,children:"Cancel"}),e.jsx(I,{variant:"primary",onClick:()=>{o.trim()&&c&&(i(o.trim(),c),m())},disabled:!o.trim()||!c,children:"Save shortcut"})]}),children:e.jsxs("div",{className:"pt-4 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Shortcut name"}),e.jsx(d,{type:"text",value:o,onChange:e=>l(e.target.value),placeholder:"eg.Photo gallery",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Display type (File/Folder)"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:c,onChange:e=>u(e.target.value),className:"w-full appearance-none rounded-lg border border-slate-300 bg-white px-3 py-2 pr-10 text-sm text-slate-700 shadow-sm transition placeholder:text-slate-400 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"",children:"Select type"}),[{value:"file",label:"File"},{value:"folder",label:"Folder"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsx("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(x,{className:"h-4 w-4 text-slate-400"})})]})]})]})})},F=({isVisible:s,onClose:a,onSave:i,itemName:n,itemType:o="folder"})=>{const[l,c]=t.useState(""),[d,u]=t.useState([]),[m,f]=t.useState(!1),p=()=>{c(""),u([]),f(!1),a()};return e.jsx(r,{isVisible:s,onClose:p,title:"",subtitle:"",width:400,padding:{top:24,right:24,bottom:0,left:24},showCloseButton:!1,showHeaderBorder:!1,customHeader:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Restrict"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:["Control who can view this ",o,"'s content"]})]}),e.jsx("button",{type:"button",onClick:p,className:"inline-flex h-9 w-9 -mt-1 items-center justify-center rounded-md text-slate-500 transition-colors hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/40",children:e.jsx(h,{className:"h-5 w-5"})})]}),footer:e.jsxs("div",{className:"flex justify-end gap-3 py-4 -mt-2 bg-white",children:[e.jsx(I,{variant:"secondary",onClick:p,children:"Cancel"}),e.jsx(I,{variant:"primary",onClick:()=>{i(l,d,m),p()},children:"Save"})]}),children:e.jsxs("div",{className:"pt-4 pb-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Visibility"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:l,onChange:e=>c(e.target.value),className:"w-full appearance-none rounded-lg border border-slate-300 bg-white px-3 py-2 pr-10 text-sm text-slate-700 shadow-sm transition placeholder:text-slate-400 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"",children:"eg.Photo gallery"}),[{value:"public",label:"Public"},{value:"private",label:"Private"},{value:"restricted",label:"Restricted"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsx("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(x,{className:"h-4 w-4 text-slate-400"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Allow access by group"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:d.join(","),onChange:e=>{const t=e.target.value?e.target.value.split(","):[];u(t)},multiple:!1,className:"w-full appearance-none rounded-lg border border-slate-300 bg-white px-3 py-2 pr-10 text-sm text-slate-700 shadow-sm transition placeholder:text-slate-400 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"",children:"Select groups"}),[{value:"group1",label:"Group 1"},{value:"group2",label:"Group 2"},{value:"group3",label:"Group 3"}].map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsx("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(x,{className:"h-4 w-4 text-slate-400"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"applyToSubFolders",checked:m,onChange:e=>f(e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-primary focus:ring-primary/20"}),e.jsx("label",{htmlFor:"applyToSubFolders",className:"text-sm text-slate-700 cursor-pointer",children:"Apply restriction to all sub-folders"})]})]})})},T=({isVisible:s,onClose:l,onCreate:d,initialName:u="",parentFolderId:m=null})=>{const[f,p]=t.useState(u),[h,x]=t.useState(!1),g=t.useRef(null),{createdEvent:v}=c();t.useEffect(()=>{s&&(p(u),x(!1),setTimeout(()=>{var e,t;null==(e=g.current)||e.focus(),null==(t=g.current)||t.select()},100))},[s,u]);const y=async()=>{if(f.trim()&&!h&&(null==v?void 0:v.uuid)){x(!0);try{const e={name:f.trim(),event_uuid:v.uuid};m&&(e.parent=m);const t=await(async e=>{try{const t=localStorage.getItem("accessToken");if(!t){const e=a("Authentication required. Please log in again.",void 0,"Authentication required. Please log in again.");throw new Error(e)}const s=localStorage.getItem("organizationUuid");if(!s){const e=a("Organization UUID is required. Please set up your organization first.",void 0,"Organization UUID is required. Please set up your organization first.");throw new Error(e)}const r={name:e.name,event_uuid:e.event_uuid};e.parent&&(r.parent=e.parent);const o=await fetch(i.RESOURCE.CREATE_FOLDER,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Organization":s},body:JSON.stringify(r)}),l=await o.text();if(!o.ok){let e=null;try{e=JSON.parse(l)}catch{}const t=a(e||l,o,"An error occurred. Please try again.");throw new Error(t)}let c,d;try{c=JSON.parse(l)}catch{const e=n("Invalid response format from server. Please try again.");throw new Error(e)}if("success"===c.status&&c.data)d=c.data;else{if(!c.uuid){const e=n("Invalid response format from server. Please try again.");throw new Error(e)}d=c}return d}catch(t){if(t instanceof TypeError&&t.message.includes("fetch"))throw t.message.includes("Cannot connect")||o(),new Error(t.message||"Network error occurred");if(t instanceof Error&&(t.message.includes("Cannot connect")||t.message.includes("Invalid response")||t.message.includes("Authentication required")||t.message.includes("Organization UUID")||t.message.includes("Failed to")))throw t;const e=t instanceof Error?t.message:"An error occurred. Please try again.";throw a(e,void 0,"An error occurred. Please try again."),new Error(e)}})(e);d({uuid:t.uuid,name:t.name}),p(""),l()}catch(e){e instanceof Error&&e.message.includes("already exists")&&d({uuid:"",name:""})}finally{x(!1)}}};return e.jsx(r,{isVisible:s,onClose:l,title:u?"Rename folder":"Create folder",subtitle:u?"Enter a new name for this folder":"Enter a name for the new folder",width:400,showHeaderBorder:!1,footer:e.jsxs("div",{className:"flex justify-end gap-3 mb-4",children:[e.jsx(I,{variant:"secondary",onClick:l,disabled:h,children:"Cancel"}),e.jsx(I,{variant:"primary",onClick:y,disabled:!f.trim()||h,children:h?"Creating...":u?"Rename":"Create"})]}),children:e.jsx("div",{className:"space-y-4 mb-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Folder name"}),e.jsx("input",{ref:g,type:"text",value:f,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"===e.key?y():"Escape"===e.key&&l()},className:"w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"Enter folder name",autoFocus:!0})]})})})},q=({eventName:r,isDraft:l,onBackClick:d,userAvatarUrl:h,onCardClick:x,hideNavbarAndSidebar:q=!1})=>{const{eventData:R,createdEvent:L}=c(),B=(null==L?void 0:L.eventName)||(null==R?void 0:R.eventName)||r||"Highly important conference of 2025",M=void 0===l||l,[V,$]=t.useState([]),[_,W]=t.useState([]),[J,G]=t.useState([]),[H,X]=t.useState(!1),[K,Y]=t.useState(""),[Q,Z]=t.useState("all"),[ee,te]=t.useState(null),[se,re]=t.useState(null),[ae,ie]=t.useState(null),[ne,oe]=t.useState(!1),[le,ce]=t.useState(null),[de,ue]=t.useState(!1),[me,fe]=t.useState(null),[pe,he]=t.useState(!1),[xe,ge]=t.useState(null),[ve,ye]=t.useState(!1),[we,be]=t.useState(null),[je,Ne]=t.useState(!1),[Ee,Ce]=t.useState(!1),[Se,Ie]=t.useState(null),[Ue,ke]=t.useState(""),[Pe,De]=t.useState(null),[Oe,Ae]=t.useState(""),ze=t.useRef(null),Fe=t.useRef(null),Te=t.useRef(null),qe=t.useRef({}),Re=t.useRef({}),Le=t.useMemo(()=>{const t=m.map(e=>({id:e.id,label:e.title,icon:e.icon}));return[{id:"overview",label:"Overview",icon:e.jsx(g,{className:"h-5 w-5"})},{id:"event-website",label:"Event website",icon:e.jsx(v,{className:"h-5 w-5"})},{id:"event-hub",label:"Event Hub",icon:e.jsx(y,{className:"h-5 w-5"}),subItems:t}]},[]),Be=t.useCallback(async()=>{if(null==L?void 0:L.uuid){X(!0);try{const e=await(async e=>{try{const t=[],s=await D(e,null);t.push(...s);const r=async s=>{const a=await D(e,s);t.push(...a);for(const e of a)await r(e.uuid)};for(const e of s)await r(e.uuid);return t}catch(t){throw t}})(L.uuid),t=e.map(e=>({id:e.uuid,name:e.name,files:[],parentId:e.parent||null}));$(t)}catch(e){}finally{X(!1)}}},[null==L?void 0:L.uuid]),Me=t.useCallback(async()=>{if(null==L?void 0:L.uuid){X(!0);try{const e=(await D(L.uuid,se)).map(e=>({id:e.uuid,name:e.name,files:[],parentId:e.parent||null}));W(e)}catch(e){}finally{X(!1)}}},[null==L?void 0:L.uuid,se]);t.useEffect(()=>{Be()},[Be]),t.useEffect(()=>{Me()},[Me]);const Ve=t.useCallback(async()=>{if(null==L?void 0:L.uuid)try{const e=await(async e=>{try{const t=localStorage.getItem("accessToken");if(!t){const e=a("Authentication required. Please log in again.",void 0,"Authentication required. Please log in again.");throw new Error(e)}const s=localStorage.getItem("organizationUuid");if(!s){const e=a("Organization UUID is required. Please set up your organization first.",void 0,"Organization UUID is required. Please set up your organization first.");throw new Error(e)}const r=i.RESOURCE.LIST_FILES(e),o=await fetch(r,{method:"GET",headers:{Authorization:`Bearer ${t}`,"X-Organization":s,"Content-Type":"application/json"}});if(!o.ok){const e=await o.text();let t=null;try{t=JSON.parse(e)}catch{}const s=a(t||e,o,"Failed to fetch files. Please try again.");throw new Error(s)}const l=await o.text();let c,d;try{c=JSON.parse(l)}catch{const e=n("Invalid response format from server. Please try again.");throw new Error(e)}if("success"===c.status&&Array.isArray(c.data))d=c.data;else{if(!Array.isArray(c)){const e=n("Invalid response format from server. Please try again.");throw new Error(e)}d=c}return d}catch(t){if(t instanceof TypeError&&t.message.includes("fetch"))throw t.message.includes("Cannot connect")||o(),new Error(t.message||"Network error occurred");if(t instanceof Error&&(t.message.startsWith("Cannot connect")||t.message.startsWith("Server error")||t.message.startsWith("Invalid response")||t.message.startsWith("Authentication required")||t.message.startsWith("Organization UUID")))throw t;const e=t instanceof Error?t.message:"Failed to fetch files. Please try again.";throw a(e,void 0,"Failed to fetch files. Please try again."),new Error(e)}})(se),t=e.map(e=>{var t;const s=(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase())||"",r=e.content_type||"";let a="other";return["jpg","jpeg","png","gif","webp","svg"].includes(s)||r.startsWith("image/")?a="image":["pdf","doc","docx","xls","xlsx","txt"].includes(s)||r.includes("pdf")||r.includes("document")||r.includes("spreadsheet")?a="document":(["mp4","avi","mov","wmv","flv","webm"].includes(s)||r.startsWith("video/"))&&(a="video"),{id:e.uuid,name:e.name,type:a,file:null,preview:"image"===a?e.file:void 0,folderId:e.folder||se||null}});G(t)}catch(e){}},[null==L?void 0:L.uuid,se]);t.useEffect(()=>{Ve()},[Ve]);const $e=e=>{re(e)},_e=(e,t)=>{e.preventDefault(),e.stopPropagation(),ie({isOpen:!0,x:e.clientX,y:e.clientY,type:"file",id:t})},We=(e,t)=>{t.trim()&&W(s=>s.map(s=>s.id===e?{...s,name:t.trim()}:s)),Ie(null),ke("")},Je=(e,t)=>{"Enter"===e.key?We(t,Ue):"Escape"===e.key&&(Ie(null),ke(""))},Ge=(e,t)=>{const s=[],r=t.filter(t=>t.parentId===e);for(const a of r){s.push(a.id);const e=Ge(a.id,t);s.push(...e)}return s},He=(e,t)=>{t.trim()&&G(s=>s.map(s=>s.id===e?{...s,name:t.trim()}:s)),De(null),Ae("")},Xe=(e,t)=>{"Enter"===e.key?He(t,Oe):"Escape"===e.key&&(De(null),Ae(""))},Ke=t.useMemo(()=>{const e=[{id:null,name:"All media"}];if(!se)return e;const t=(e,s)=>{if(!e)return s;const r=V.find(t=>t.id===e);return r?(s.push({id:r.id,name:r.name}),r.parentId?t(r.parentId,s):s):s},s=t(se,[]).reverse();return[...e,...s]},[se,V]),Ye=e=>{e.preventDefault()},Qe=e=>{var t;return(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""},Ze=t=>{if("image"===t.type)return null;if((e=>{const t=Qe(e.name);return["xls","xlsx","xlsm","xlsb"].includes(t)})(t)){const s=Qe(t.name).toUpperCase()||"XLS";return e.jsx("div",{className:"relative h-12 w-12 flex-shrink-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative h-10 w-8",children:[e.jsx("div",{className:"absolute left-0 top-0 h-10 w-8 bg-[#079455] rounded-sm"}),e.jsx("div",{className:"absolute left-5 top-0.5 h-2.5 w-2.5 bg-white opacity-30 rounded-sm"}),e.jsx("div",{className:"absolute left-0.5 top-[18px] w-7 text-center text-[8px] font-bold leading-none text-white",style:{fontFamily:"Inter"},children:s})]})})}if((e=>{const t=Qe(e.name);return["doc","docx","docm"].includes(t)})(t)){const s=Qe(t.name).toUpperCase()||"DOC";return e.jsx("div",{className:"relative h-12 w-12 flex-shrink-0 flex items-center justify-center",children:e.jsxs("div",{className:"relative h-10 w-8",children:[e.jsx("div",{className:"absolute left-0 top-0 h-10 w-8 bg-[#2B579A] rounded-sm"}),e.jsx("div",{className:"absolute left-5 top-0.5 h-2.5 w-2.5 bg-white opacity-30 rounded-sm"}),e.jsx("div",{className:"absolute left-0.5 top-[18px] w-7 text-center text-[8px] font-bold leading-none text-white",style:{fontFamily:"Inter"},children:s})]})})}return"document"===t.type||t.type,e.jsx(S,{className:"h-12 w-12 text-slate-400"})},et=t.useMemo(()=>{let e=_.filter(e=>null===se?null===e.parentId||void 0===e.parentId:String(e.parentId)===String(se));return K&&(e=e.filter(e=>e.name.toLowerCase().includes(K.toLowerCase()))),e},[_,se,K]),tt=t.useMemo(()=>{let e=J.filter(e=>e.folderId===se);return"all"!==Q&&(e=e.filter(e=>e.type===Q)),K&&(e=e.filter(e=>e.name.toLowerCase().includes(K.toLowerCase()))),e},[J,se,Q,K]);return e.jsxs("div",{className:"min-h-screen overflow-x-hidden bg-white",children:[!q&&e.jsxs(e.Fragment,{children:[e.jsx(u,{eventName:B,isDraft:M,onBackClick:d,onSearchClick:()=>{},onNotificationClick:()=>{},onProfileClick:()=>{},userAvatarUrl:h}),e.jsx(f,{items:Le,activeItemId:"resource-management",onItemClick:e=>{if("event-hub"===e&&d)d();else if("resource-management"!==e){m.some(t=>t.id===e)&&x&&x(e)}}})]}),e.jsx("div",{className:q?"":"md:pl-[250px]",children:e.jsxs("div",{className:"space-y-6 px-4 pb-12 pt-8 md:px-10 lg:px-16",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsx("h1",{className:"text-[26px] font-bold text-primary-dark",children:"Resource Management"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{variant:"secondary",onClick:()=>{Ce(!0)},iconLeading:e.jsx(w,{className:"h-4 w-4"}),children:"Upload"}),e.jsx(I,{variant:"primary",onClick:()=>{Ne(!0)},iconLeading:e.jsx(b,{className:"h-4 w-4"}),children:"New folder"})]})]}),e.jsx("input",{ref:ze,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,video/*",onChange:e=>{const t=e.target.files;t&&(Array.from(t).forEach(e=>{var t;const s=`file-${Date.now()}-${Math.random()}`,r=(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase())||"";let a="other";["jpg","jpeg","png","gif","webp","svg"].includes(r)?a="image":["pdf","doc","docx","xls","xlsx","txt"].includes(r)?a="document":["mp4","avi","mov","wmv","flv","webm"].includes(r)&&(a="video");const i={id:s,name:e.name,type:a,file:e,preview:"image"===a?URL.createObjectURL(e):void 0,folderId:se};G(e=>[...e,i])}),ze.current&&(ze.current.value=""))},className:"hidden"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-end sm:items-center justify-between gap-3 mb-0",children:[e.jsx("div",{className:"flex items-end -mb-16",children:e.jsx("button",{type:"button",onClick:()=>Z("all"),className:"text-sm font-medium transition-colors pb-2 "+("all"===Q?"text-primary border-b-2 border-primary":"text-slate-600 hover:text-primary"),children:"All media"})}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex flex-1 sm:flex-none items-center border border-slate-200 rounded-lg overflow-hidden bg-white",children:[e.jsx("input",{type:"text",value:K,onChange:e=>Y(e.target.value),placeholder:"Search resources",className:"px-3 py-2 text-sm text-slate-600 placeholder:text-slate-400 focus:outline-none w-full sm:w-[300px] border-0"}),e.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center bg-primary text-white transition hover:bg-primary/90 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 flex-shrink-0 rounded-none","aria-label":"Search",children:e.jsx(j,{className:"h-4 w-4",strokeWidth:2})})]}),e.jsx("button",{type:"button",onClick:()=>{},className:"inline-flex shrink-0 h-10 w-10 items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-500 transition hover:border-primary/40 hover:text-primary focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/40","aria-label":"Filter resources",children:e.jsx(N,{className:"h-4 w-4",strokeWidth:2})})]})]}),e.jsxs("div",{className:"border border-slate-200 rounded-lg bg-white min-h-[400px]",children:[e.jsx("div",{className:"px-4 md:px-8 pt-4 pb-2 border-b border-slate-200",children:e.jsx("div",{className:"flex items-center gap-2 text-sm",children:Ke.map((t,r)=>e.jsxs(s.Fragment,{children:[r>0&&e.jsx(E,{className:"h-4 w-4 text-slate-400"}),e.jsx("button",{type:"button",onClick:()=>re(t.id),className:""+(r===Ke.length-1?"text-slate-900 font-medium":"text-slate-600 hover:text-primary"),children:t.name})]},t.id||"root"))})}),e.jsxs("div",{className:"p-4 md:p-8",children:[et.length>0&&e.jsx("div",{className:"flex flex-wrap gap-4 mb-6",children:et.map(t=>e.jsxs("div",{ref:e=>qe.current[t.id]=e,className:"group relative inline-flex flex-col items-center gap-2 p-3 hover:bg-primary/10 bg-white  hover:shadow-md transition-all ",onContextMenu:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),ie({isOpen:!0,x:e.clientX,y:e.clientY,type:"folder",id:t})})(e,t.id),onDragOver:Ye,onDrop:()=>{return e=t.id,void(ee&&(G(t=>t.map(t=>t.id===ee?{...t,folderId:e}:t)),te(null)));var e},children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center cursor-pointer",onClick:()=>{Se!==t.id&&$e(t.id)},children:e.jsx(p,{className:"h-8 w-8 text-primary"})}),Se===t.id?e.jsx("input",{ref:Fe,type:"text",value:Ue,onChange:e=>ke(e.target.value),onBlur:()=>We(t.id,Ue),onKeyDown:e=>Je(e,t.id),className:"text-sm font-medium text-slate-700 text-center max-w-[80px] px-1 py-0.5  focus:outline-none focus:ring-1 focus:ring-primary",onClick:e=>e.stopPropagation()}):e.jsx("span",{className:"text-sm font-medium text-slate-700 text-center max-w-[100px] line-clamp-2 cursor-pointer",onClick:()=>{Se!==t.id&&$e(t.id)},children:t.name})]},t.id))}),tt.length>0&&e.jsx("div",{className:"grid grid-cols-2  sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8",children:tt.map(t=>e.jsxs("div",{ref:e=>Re.current[t.id]=e,draggable:!0,onDragStart:()=>{return e=t.id,void te(e);var e},className:"group relative flex w-32 cursor-move flex-col items-center justify-center gap-2 rounded-lg border border-slate-200 bg-white p-2 hover:shadow-md transition-all",onContextMenu:e=>_e(e,t.id),children:[e.jsxs("div",{className:"relative flex h-24 w-full flex-col items-end justify-between rounded-lg overflow-hidden bg-slate-50 flex-shrink-0",children:["image"===t.type&&t.preview?e.jsx("img",{src:t.preview,alt:t.name,className:"absolute inset-0 h-full w-full object-cover",onError:e=>{var t;const s=e.currentTarget;s.style.display="none";const r=null==(t=s.parentElement)?void 0:t.querySelector(".file-icon-fallback");r&&(r.style.display="flex")}}):null,e.jsx("div",{className:"absolute inset-0 flex items-center justify-center file-icon-fallback "+("image"===t.type&&t.preview?"hidden":""),children:Ze(t)}),e.jsx("button",{type:"button",className:"relative z-10 flex h-8 w-8 cursor-pointer items-center justify-center rounded-full bg-white/90 backdrop-blur-sm border border-slate-300 p-0 transition-all opacity-0 group-hover:opacity-100 hover:bg-white",onClick:e=>{e.stopPropagation(),_e(e,t.id)},"aria-label":"More options",children:e.jsx(C,{className:"h-4 w-4 text-slate-600"})})]}),Pe===t.id?e.jsx("input",{ref:Te,type:"text",value:Oe,onChange:e=>Ae(e.target.value),onBlur:()=>He(t.id,Oe),onKeyDown:e=>Xe(e,t.id),className:"w-full text-xs font-medium text-slate-700 text-center px-1 py-0.5 rounded border border-primary focus:outline-none focus:ring-1 focus:ring-primary",onClick:e=>e.stopPropagation()}):e.jsx("div",{className:"w-full break-words text-center text-xs font-medium text-slate-700 line-clamp-2 min-h-[2rem] flex items-center justify-center",children:t.name})]},t.id))}),0===et.length&&0===tt.length&&e.jsx("div",{className:"flex min-h-[400px] items-center justify-center text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"h-16 w-16 text-slate-400 mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-slate-600",children:"No files found"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:K?"Try adjusting your search terms":"Upload media files or create folders to get started"})]})]})})]})]}),ae&&e.jsx(k,{isOpen:ae.isOpen,onClose:()=>ie(null),options:(()=>{if(!ae)return[];if("folder"===ae.type){const e=_.find(e=>e.id===ae.id);return e?[{label:"Rename",action:()=>{(e=>{const t=_.find(t=>t.id===e);t&&(Ie(e),ke(t.name),setTimeout(()=>{var e,t;null==(e=Fe.current)||e.focus(),null==(t=Fe.current)||t.select()},0))})(e.id)}},{label:"Delete",action:()=>{fe({id:e.id,name:e.name,type:"folder"}),ue(!0)},variant:"destructive"}]:[]}{const e=J.find(e=>e.id===ae.id);return e?[{label:"Rename",action:()=>{(e=>{const t=J.find(t=>t.id===e);t&&(De(e),Ae(t.name),setTimeout(()=>{var e,t;null==(e=Te.current)||e.focus(),null==(t=Te.current)||t.select()},0))})(e.id)}},{label:"Move to folder",action:()=>{ce(e),oe(!0)}},{label:"Duplicate",action:()=>(e=>{var t;const s=J.find(t=>t.id===e);if(s){const e={...s,id:`file-${Date.now()}-${Math.random()}`,name:`${s.name.replace(/\.[^/.]+$/,"")} (copy)${(null==(t=s.name.match(/\.[^/.]+$/))?void 0:t[0])||""}`};G(t=>[...t,e])}})(e.id)},{label:"Share/Gallery shortcut",action:()=>{ge(e),he(!0)}},{label:"Restrict access",action:()=>{be({id:e.id,name:e.name,type:"file"}),ye(!0)}},{label:"Delete",action:()=>{fe({id:e.id,name:e.name,type:"file"}),ue(!0)},variant:"destructive"}]:[]}})(),position:{x:ae.x,y:ae.y}}),e.jsx(P,{isVisible:ne,onClose:()=>{oe(!1),ce(null)},onMove:e=>{var t,s;le&&(t=le.id,s=e,G(e=>e.map(e=>e.id===t?{...e,folderId:s}:e)),ce(null))},folders:_,currentFolderId:(null==le?void 0:le.folderId)||void 0,fileName:(null==le?void 0:le.name)||""}),e.jsx(A,{isVisible:de,onClose:()=>{ue(!1),fe(null)},onConfirm:()=>{var e;me&&("folder"===me.type?(e=>{const t=Ge(e,V);$(s=>s.filter(s=>s.id!==e&&!t.includes(s.id))),W(s=>s.filter(s=>s.id!==e&&!t.includes(s.id)));const s=[e,...t];G(e=>e.filter(e=>!s.includes(e.folderId||""))),se&&(se===e||t.includes(se))&&re(null),Me()})(me.id):(e=me.id,G(t=>t.filter(t=>t.id!==e)),Ve()))},itemName:(null==me?void 0:me.name)||"",itemType:(null==me?void 0:me.type)||"file",itemId:null==me?void 0:me.id}),e.jsx(z,{isVisible:pe,onClose:()=>{he(!1),ge(null)},onSave:(e,t)=>{},fileName:null==xe?void 0:xe.name}),e.jsx(F,{isVisible:ve,onClose:()=>{ye(!1),be(null)},onSave:(e,t,s)=>{},itemName:null==we?void 0:we.name,itemType:(null==we?void 0:we.type)||"folder"}),e.jsx(T,{isVisible:je,onClose:()=>Ne(!1),onCreate:e=>{Be(),Me(),Ne(!1)},parentFolderId:se}),e.jsx(U,{isOpen:Ee,onClose:()=>Ce(!1),onUpload:async e=>{var t;if(null==L?void 0:L.uuid){for(const r of e)try{const e=await O({file:r,event_uuid:L.uuid,parent:se||void 0}),s=(null==(t=r.name.split(".").pop())?void 0:t.toLowerCase())||"",a=e.content_type||"";let i="other";["jpg","jpeg","png","gif","webp","svg"].includes(s)||a.startsWith("image/")?i="image":["pdf","doc","docx","xls","xlsx","txt"].includes(s)||a.includes("pdf")||a.includes("document")||a.includes("spreadsheet")?i="document":(["mp4","avi","mov","wmv","flv","webm"].includes(s)||a.startsWith("video/"))&&(i="video");const n={id:e.uuid,name:e.name,type:i,file:r,preview:"image"===i?e.file:void 0,folderId:e.folder||se||null};G(e=>[...e,n])}catch(s){}Ve()}},title:"Upload and attach files",description:"Upload and attach files to this project.",uploadText:"Click to upload or drag and drop",accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt,video/*",multiple:!0,showTemplate:!1,buttonText:"Attach files",cancelButtonText:"Cancel",instructions:["SVG, PNG, JPG or GIF (max. 800Ã—400px)"]})]})})]})};export{q as default};
