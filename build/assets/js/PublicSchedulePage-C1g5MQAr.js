import{j as e}from"./puck-vendor-BeE6vXWX.js";import{r as t,R as r}from"./react-vendor-BdxBrZfF.js";import{r as n}from"./eventLocalStore-CWbqpkVu.js";import{a as s}from"./ScheduleContent-CHQq89M5.js";import{h as a,A as o,a as i,b as l}from"./index-BmzR9LWJ.js";import"./icons-vendor-B3tUBqWS.js";import"./Button-DeyD9Sc1.js";import"./UploadModal-BCOvM5Mg.js";const d=e=>{const t=new Date(e);return t.setHours(0,0,0,0),t.getTime()},c=e=>{const t={time:"00:00",period:"AM"};if(null==e)return t;const r=(e,t)=>{const r=Number.isFinite(e)?(e%24+24)%24:0,n=Number.isFinite(t)?(t%60+60)%60:0,s=r>=12?"PM":"AM";return{time:`${String(r).padStart(2,"0")}:${String(n).padStart(2,"0")}`,period:s}};if("number"==typeof e&&Number.isFinite(e)){if(e>1e10){const t=new Date(e);if(!Number.isNaN(t.getTime()))return r(t.getHours(),t.getMinutes())}if(e>=0&&e<1){const t=Math.round(24*e*60);return r(Math.floor(t/60)%24,t%60)}if(e>=0&&e<1440){return r(Math.floor(e/60),Math.round(e%60))}}const n=String(e).trim();if(!n)return t;if(n.includes("T")){const e=new Date(n);if(!Number.isNaN(e.getTime()))return r(e.getHours(),e.getMinutes())}const s=n.match(/^(\d{1,2}):(\d{2})(?::\d{2}(?:\.\d+)?)?\s*(AM|PM)$/i);if(s){let e=Number(s[1]);const t=Number(s[2]),n=s[3].toUpperCase();return"PM"===n&&12!==e&&(e+=12),"AM"===n&&12===e&&(e=0),r(e,t)}const a=n.match(/^(\d{1,2}):(\d{2})(?::\d{2}(?:\.\d+)?)?$/);if(a){return r(Number(a[1]),Number(a[2]))}return t},u=e=>String(e??"").trim().toLowerCase().replace(/\s+/g," "),m=({eventUuid:m})=>{const[h,f]=t.useState([]),[p,g]=t.useState(!1),[y,w]=t.useState([]),[v,b]=t.useState("idle"),[A,N]=t.useState(!1),[S,x]=t.useState(""),[T,E]=t.useState("unknown"),M=t.useMemo(()=>n(m,"schedule",[]),[m]),_=M.length>0,j=t.useMemo(()=>n(m,"sessions",{}),[m]),D=t.useMemo(()=>"api"===T?h:M,[h,T,M]);t.useEffect(()=>{let e=!1;return(async()=>{if(_)return E("fallback"),f([]),void g(!1);g(!0),E("unknown");try{const t=await(async e=>{try{if(!e){const e=a("Event UUID is required.",void 0,"Event UUID is required.");throw new Error(e)}const r=o.PUBLIC.SCHEDULES.LIST(e),n=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n||!n.ok){if(!n){const e=i(null);throw new Error(e)}try{const e=await n.text();let t=null;try{t=e?JSON.parse(e):null}catch{if(e&&e.trim()){const t=a(e.trim(),n,"An error occurred. Please try again.");throw new Error(t)}}if(t){const e=a(t,n,"An error occurred. Please try again.");throw new Error(e)}const r=a(null,n,"An error occurred. Please try again.");throw new Error(r)}catch(t){if(t instanceof Error)throw t;const e=a(null,n,"An error occurred. Please try again.");throw new Error(e)}}let s;try{s=await n.json()}catch{const e=l("Invalid response from server. Please try again.");throw new Error(e)}if("error"===(null==s?void 0:s.status)){const e=a(s,void 0,"Failed to fetch schedules. Please try again.");throw new Error(e)}const d=(null==s?void 0:s.data)??(null==s?void 0:s.results)??s;return Array.isArray(d)?d:d&&"object"==typeof d&&Array.isArray(d.results)?d.results:[]}catch(r){if(r instanceof TypeError&&r.message.includes("fetch"))throw r.message.includes("Cannot connect")||i(),new Error(r.message||"Network error occurred");throw r instanceof Error?r:new Error("Failed to fetch schedules. Please try again.")}})(m),r=(Array.isArray(t)?t:[]).map((e,t)=>({id:String(e.uuid??e.id??`schedule-${t}`),name:String(e.name??e.title??"Schedule"),sessions:[]}));e||(f(r),r.length>0?E("api"):E("fallback"))}catch{e||(f([]),E("fallback"))}finally{e||g(!1)}})(),()=>{e=!0}},[m,_]),t.useEffect(()=>{0!==D.length?S&&D.some(e=>e.id===S)||x(D[0].id):S&&x("")},[S,D]);const $=t.useMemo(()=>D.find(e=>e.id===S)||D[0]||null,[S,D]),I=t.useMemo(()=>{const e=M.find(e=>e.id===S);if(e)return e;return((null==$?void 0:$.name)?M.find(e=>u(e.name)===u($.name)):void 0)||M[0]||null},[null==$?void 0:$.name,S,M]),P=t.useMemo(()=>{const e=(null==I?void 0:I.sessions)||[],t=Array.isArray(e)?e:[];if(t.length)return t;const r=((null==I?void 0:I.id)&&Array.isArray(j[I.id])?j[I.id]:void 0)??(S&&Array.isArray(j[S])?j[S]:void 0);return Array.isArray(r)?r:[]},[S,I,j]);t.useEffect(()=>{let e=!1;return(async()=>{if("api"!==T)return w([]),void b("idle");if(!(null==$?void 0:$.id))return w([]),void b("error");N(!0),b("loading");try{const t=await(async(e,t)=>{try{if(!e){const e=a("Event UUID is required.",void 0,"Event UUID is required.");throw new Error(e)}if(!t){const e=a("Schedule UUID is required.",void 0,"Schedule UUID is required.");throw new Error(e)}const n=o.PUBLIC.SESSIONS.LIST(e,t),s=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s||!s.ok){if(!s){const e=i(null);throw new Error(e)}try{const e=await s.text();let t=null;try{t=e?JSON.parse(e):null}catch{if(e&&e.trim()){const t=a(e.trim(),s,"An error occurred. Please try again.");throw new Error(t)}}if(t){const e=a(t,s,"An error occurred. Please try again.");throw new Error(e)}const r=a(null,s,"An error occurred. Please try again.");throw new Error(r)}catch(r){if(r instanceof Error)throw r;const e=a(null,s,"An error occurred. Please try again.");throw new Error(e)}}let d;try{d=await s.json()}catch{const e=l("Invalid response from server. Please try again.");throw new Error(e)}if("error"===(null==d?void 0:d.status)){const e=a(d,void 0,"Failed to fetch sessions. Please try again.");throw new Error(e)}const c=(null==d?void 0:d.data)??(null==d?void 0:d.results)??d;return Array.isArray(c)?c:c&&"object"==typeof c&&Array.isArray(c.results)?c.results:[]}catch(n){if(n instanceof TypeError&&n.message.includes("fetch"))throw n.message.includes("Cannot connect")||i(),new Error(n.message||"Network error occurred");throw n instanceof Error?n:new Error("Failed to fetch sessions. Please try again.")}})(m,$.id),r=(Array.isArray(t)?t:[]).map((e,t)=>{const r=String(e.uuid??e.id??`session-${t}`),n=String(e.title??e.name??"Session"),s=e.start_time??e.startTime??e.start??e.start_at??e.startAt??e.start_datetime??e.startDateTime??e.starts_at??e.startsAt,a=e.end_time??e.endTime??e.end??e.end_at??e.endAt??e.end_datetime??e.endDateTime??e.ends_at??e.endsAt,o=c(s),i=c(a),l=(e=>{if(!e)return null;if(e instanceof Date&&!Number.isNaN(e.getTime()))return e;const t=String(e).trim();if(!t)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(t)){const e=new Date(`${t}T00:00:00`);return Number.isNaN(e.getTime())?null:e}const r=new Date(t);return Number.isNaN(r.getTime())?null:r})(e.date??e.day??e.session_date??e.sessionDate??e.start_date??e.startDate??e.start_datetime??e.startDateTime),d=e.parent_uuid??e.parentUuid??e.parent_id??e.parentId??null,u=e.parent_session??e.parentSession??e.parent_session_title??e.parentSessionTitle??e.parent_title??e.parentTitle??e.parent??null,m=Array.isArray(e.attachments)?e.attachments:[],h=Number(e.attachments_count??e.attachmentsCount??m.length??0),f=m.length?m:h>0?new Array(h).fill({}):[],p=l?l.toISOString().slice(0,10):"",g="string"==typeof u?u.trim():u?String(u).trim():"";return{id:r,title:n,startTime:o.time,startPeriod:o.period,endTime:i.time,endPeriod:i.period,location:String(e.location??e.room??e.venue??""),sessionType:String(e.session_type??e.sessionType??""),tags:Array.isArray(e.tags)?e.tags:[],sections:Array.isArray(e.sections)?e.sections:[],attachments:f,date:l??void 0,parentId:d?String(d):void 0,__parentTitle:g||void 0,__dateKey:p||void 0}}),n=(e,t)=>{const[r,n]=String(e||"00:00").split(":");let s=Number(r||0);const a=Number(n||0),o=String(t||"AM").toUpperCase();return s>=13||("PM"===o&&12!==s&&(s+=12),"AM"===o&&12===s&&(s=0)),60*s+a},s=e=>Boolean(e.parentId)||Boolean(e.__parentTitle),d=new Map;r.forEach(e=>{if(s(e))return;const t=`${e.__dateKey||""}||${u(e.title)}`,r=d.get(t)??[];r.push(e),d.set(t,r)}),d.forEach(e=>{e.sort((e,t)=>n(e.startTime,e.startPeriod||"AM")-n(t.startTime,t.startPeriod||"AM"))});const h=e=>{const t=e.__dateKey||"",r=u(e.__parentTitle||"");if(!t||!r)return;const s=d.get(`${t}||${r}`)??[];if(!s.length)return;if(1===s.length)return s[0].id;const a=n(e.startTime,e.startPeriod||"AM");let o=n(e.endTime,e.endPeriod||"AM");o<a&&(o+=1440);let i=null,l=-1;for(const d of s){const e=n(d.startTime,d.startPeriod||"AM");let t=n(d.endTime,d.endPeriod||"AM");t<e&&(t+=1440),a>=e&&o<=t&&e>l&&(i=d,l=e)}return(null==i?void 0:i.id)??s[0].id},f=(e=>{const t=new Map;e.forEach(e=>{e.parentId||t.set(e.id,e)});const r=e=>((e,t)=>{const[r,n]=String(e||"00:00").split(":");let s=Number(r||0);const a=Number(n||0),o=String(t||"AM").toUpperCase();return s>=13||("PM"===o&&12!==s&&(s+=12),"AM"===o&&12===s&&(s=0)),60*s+a})(e.startTime,e.startPeriod||"AM");return[...e].sort((e,n)=>{const s=Boolean(e.parentId),a=Boolean(n.parentId),o=e.parentId?t.get(e.parentId):void 0,i=n.parentId?t.get(n.parentId):void 0,l=r(s&&o?o:e),d=r(a&&i?i:n);if(l!==d)return l-d;if(s!==a)return s?1:-1;const c=r(e),u=r(n);return c!==u?c-u:String(e.title).localeCompare(String(n.title))})})(r.map(e=>{if(!e.parentId&&e.__parentTitle){const t=h(e);return t?{...e,parentId:t}:{...e,parentId:void 0,__parentTitle:void 0}}return e}));e||(w(f),b("success"))}catch{e||(w([]),b("error"))}finally{e||N(!1)}})(),()=>{e=!0}},[null==$?void 0:$.id,T,m]);const U=t.useMemo(()=>{if("api"===T)return"success"===v?y:P;const e=(null==$?void 0:$.sessions)||[],t=Array.isArray(e)?e:[];return t.length?t:P},[$,y,v,T,P]),C=t.useMemo(()=>{const e=new Map;return U.forEach(t=>{const r=t.date?new Date(t.date):null;if(!r||Number.isNaN(r.getTime()))return;const n=d(r);e.has(n)||e.set(n,r)}),Array.from(e.entries()).sort((e,t)=>e[0]-t[0]).map(([,e])=>e)},[U]),[F,k]=t.useState(0),L=C[F]?d(C[F]):null,B=t.useMemo(()=>{const e=C[F];if(e)return e;const t=[];return U.forEach(e=>{if(!e.date)return;const r=new Date(e.date);Number.isNaN(r.getTime())||(r.setHours(0,0,0,0),t.push(r))}),t.sort((e,t)=>e.getTime()-t.getTime()),t[0]??new Date},[F,C,U]),Y=t.useMemo(()=>{if(0===C.length)return"";return((e,t)=>{const r=e.getFullYear()===t.getFullYear(),n=r&&e.getMonth()===t.getMonth(),s=new Intl.DateTimeFormat("en-US",{month:"long"}),a=new Intl.DateTimeFormat("en-US",{month:"short"});return d(e)===d(t)?`${s.format(e)} ${e.getDate()}, ${e.getFullYear()}`:n?`${s.format(e)} ${e.getDate()}–${t.getDate()}, ${e.getFullYear()}`:r?`${a.format(e)} ${e.getDate()} – ${a.format(t)} ${t.getDate()}, ${e.getFullYear()}`:`${a.format(e)} ${e.getDate()}, ${e.getFullYear()} – ${a.format(t)} ${t.getDate()}, ${t.getFullYear()}`})(C[0],C[C.length-1])},[C]),q=t.useMemo(()=>null===L?U:U.filter(e=>{if(!e.date)return!1;const t=new Date(e.date);return!Number.isNaN(t.getTime())&&d(t)===L}),[L,U]);return r.useEffect(()=>{k(0)},[S]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-6 border-b border-slate-200",children:D.map(t=>{const r=t.id===((null==$?void 0:$.id)||"");return e.jsx("button",{type:"button",onClick:()=>x(t.id),className:["py-3 text-sm font-semibold transition-colors",r?"text-primary":"text-slate-600 hover:text-slate-900"].join(" "),children:e.jsx("span",{className:["inline-block border-b-2 -mb-px",r?"border-primary":"border-transparent hover:border-slate-300"].join(" "),children:t.name||"Schedule"})},t.id)})}),Y?e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:Y}):null,C.length>1?e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:C.map((t,r)=>{const n=r===F,s=`Day ${r+1}`,a=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(t);return e.jsxs("button",{type:"button",onClick:()=>k(r),className:["rounded-lg px-3 py-2 text-sm font-semibold transition-colors",n?"bg-primary text-white":"bg-white text-slate-700 border border-slate-200 hover:bg-slate-50"].join(" "),children:[s," ",e.jsx("span",{className:"ml-2 text-xs font-medium opacity-90",children:a})]},d(t))})}):null,$?q.length?e.jsx("div",{className:["[&_input[type='checkbox']]:hidden","[&_.cursor-move]:hidden","[&_[aria-label='More options']]:hidden","[&_[aria-label='Add parallel session']]:hidden"].join(" "),children:e.jsx(s,{sessions:q,selectedDate:B})}):e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[e.jsx("div",{className:"text-base font-semibold text-slate-900",children:"No sessions"}),e.jsx("div",{className:"mt-1 text-sm text-slate-600",children:p||A?"Loading…":"This schedule doesn’t have any sessions for the selected day."})]}):e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[e.jsx("div",{className:"text-base font-semibold text-slate-900",children:"No schedules yet"}),e.jsx("div",{className:"mt-1 text-sm text-slate-600",children:p?"Loading schedules…":"Create schedules and sessions in Event Hub to publish them here."})]})]})};export{m as default};
