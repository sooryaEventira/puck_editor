import{A as e}from"./index-bcMC-VSq.js";const r=async()=>{try{const n=localStorage.getItem("accessToken"),o=localStorage.getItem("organizationUuid"),a={"Content-Type":"application/json"};n&&(a.Authorization=`Bearer ${n}`),o&&(a["X-Organization"]=o);const s=await fetch(e.TIMEZONE.LIST,{method:"GET",headers:a,credentials:"include"});if(!s||!s.ok){if(!s){throw new Error("Cannot connect to the server. Please make sure the backend server is running.")}try{const e=await s.text();let t=null;try{t=e?JSON.parse(e):null}catch(r){if(e&&e.trim())throw new Error(e.trim())}if(t){let e=t.message||t.detail||t.error||null;const r=t.errors||[];if(t.non_field_errors&&t.non_field_errors.length>0)e=t.non_field_errors.join(", ");else if(!e&&"object"==typeof t){const r=Object.keys(t);if(r.length>0){const n=t[r[0]];e=Array.isArray(n)?n.join(", "):String(n)}}const n=r.length>0?r.join(", "):e||"An error occurred";throw new Error(n)}const n=500===s.status?"Internal server error. Please try again later.":"An error occurred. Please try again.";throw new Error(n)}catch(t){if(t instanceof Error&&!t.message.includes("Server error:"))throw t;const e=500===s.status?"Internal server error. Please try again later.":"An error occurred. Please try again.";throw new Error(e)}}let i;try{const e=await s.json();if(!e||"object"!=typeof e)throw new Error("Invalid response format from server: response is not an object");if("error"===e.status){const r=e.message||"Failed to fetch timezones",t=e.errors||[],n=t.length>0?t.join(", "):r;throw new Error(n)}if("success"!==e.status){const r=`Unexpected response status: ${e.status}. Expected 'success'.`;throw new Error(r)}let r=e.data;if(!r)return[];if(Array.isArray(r))i=r.map(e=>({uuid:String(e.uuid),label:String(e.label||e.name||""),name:String(e.name||""),utc_offset:String(e.utc_offset||"+00:00")}));else{if("object"!=typeof r)throw new Error("Invalid response format: timezone data should be an array");i=r.data&&Array.isArray(r.data)?r.data.map(e=>({uuid:String(e.uuid),label:String(e.label||e.name||""),name:String(e.name||""),utc_offset:String(e.utc_offset||"+00:00")})):[{uuid:String(r.uuid),label:String(r.label||r.name||""),name:String(r.name||""),utc_offset:String(r.utc_offset||"+00:00")}]}i=i.filter(e=>e.uuid&&e.name)}catch(t){if(t instanceof Error&&t.message.includes("Invalid response format"))throw t;throw new Error("Invalid response from server. Please try again.")}return i}catch(n){if(n instanceof TypeError&&n.message.includes("fetch")){throw new Error("Cannot connect to the server. Please check if the server is running.")}if(n instanceof Error&&(n.message.startsWith("Cannot connect")||n.message.startsWith("Server error")||n.message.startsWith("Invalid response")))throw n;const e=n instanceof Error?n.message:"Failed to fetch timezones. Please try again.";throw new Error(e)}};export{r as f};
